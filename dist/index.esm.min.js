const t=/url\(["']?(.+?)["']?\)/,e=Object.freeze({woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"});function n(t){for(const n of Object.entries(e))if(t.endsWith(`.${n[0]}`))return n[1];return console.error(`Unknown font format for ${t}. Fonts may not be working correctly.`),"application/octet-stream"}const o={};async function r(e){var n;if(!o[e.url])try{const n=await fetch(e.url),r=function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}(await(n.ok?n.arrayBuffer():Promise.reject())),s=e.text.replace(t,`url("data:${e.format};base64,${r}")`)+"\n";o[e.url]=s}catch(t){console.warn(`Failed to load font from: ${e.url}`,t),o[n=e.url]||(o[n]="")}return o[e.url]}async function s(t){try{const e=await fetch(t),n=await e.text(),o=document.body.appendChild(a(n));let r=null;return o.sheet&&o.sheet.cssRules&&(r={rules:Array.from(o.sheet.cssRules),href:t}),o.remove(),r}catch(e){return console.warn(`Stylesheet could not be loaded: ${t}`,e),null}}async function i(t){try{if(t.cssRules)return{rules:t.cssRules,href:t.href}}catch(e){if(t.href)return s(t.href);console.warn(`Stylesheet could not be loaded: ${t.href}`,e)}return null}function a(t){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,e}function c(t,e,n,o){return!t.style||!!function(t,e){if(e)try{return t.querySelector(e)||t.parentNode&&t.parentNode.querySelector(e)}catch(t){console.warn(`Invalid CSS selector "${e}"`,t)}return null}(e,t.selectorText)&&(o.push(n(t.selectorText,t.style.cssText)),!0)}function l(e,o,r,s){if(s.detectFonts){const i=function(e,o,r){if(r)throw new Error("The option 'inlineAllFonts' is not implemented yet.");const s=e.match(t),i=s&&s[1]||"";if(!i||i.match(/^data:/)||"about:blank"===i)return null;let a;return a=i.startsWith("../")?`${o}/../${i}`:i.startsWith("./")?`${o}/${i}`:i,a=a.toLowerCase(),{text:e,format:n(a),url:a}}(e.cssText,o,s.inlineAllFonts);i&&r.push(i)}return!0}function u(t,e,n,o,r){return window.matchMedia(t.conditionText).matches&&h(t.cssRules,n,e,o,r),!0}function f(t,e,n,o,r){return"supports"in CSS&&CSS.supports(t.conditionText)&&h(t.cssRules,n,e,o,r),!0}async function d(t,e,n,o){if(!t.media.length||Array.from(t.media).some((t=>window.matchMedia(t).matches)))try{const r=await s(t.href);r&&await h(r.rules,t.href,e,n,o)}catch(e){console.warn(`Could not load @imported stylesheet from "${t.href}"`,e)}return!0}async function h(t,e,n,o,r){for(const s of t){let t=!1;s instanceof CSSStyleRule?t=c(s,n,r.generateCss,o.css):s instanceof CSSFontFaceRule?t=l(s,e,o.fonts,r):s instanceof CSSMediaRule?t=u(s,n,e,o,r):s instanceof CSSSupportsRule?t=f(s,n,e,o,r):s instanceof CSSImportRule&&(t=await d(s,n,o,r)),t||r.excludeUnusedCss||o.css.push(s.cssText)}}async function w(t,e){const{selectorRemap:n,modifyStyle:o,modifyCss:s,fonts:a,inlineAllFonts:c=!1,excludeUnusedCss:l=!1}=e||{},u={css:[],fonts:a||[]},f={generateCss:s||((t,e)=>`${n?n(t):t}{${o?o(e):e}}\n`),excludeUnusedCss:l,detectFonts:!a,inlineAllFonts:c},d=await async function(){return Promise.all(Array.from(document.styleSheets).filter((t=>!t.media||window.matchMedia(t.media.toString()).matches)).map(i)).then((t=>t.filter((t=>t))))}();for(const{rules:e,href:n}of d)await h(e,n,t,u,f);const w=await async function(t){return(await Promise.all(t.map(r))).join("")}(u.fonts);return u.css.join("\n")+w}const m="http://www.w3.org/2000/xmlns/",g="http://www.w3.org/1999/xhtml",p="http://www.w3.org/2000/svg",y="http://www.w3.org/1999/xlink";function b(t,e){return new Promise(((n,o)=>{const r=document.createElement("canvas"),s=new Image;s.crossOrigin="anonymous",s.onerror=()=>o(new Error(`Could not load ${e}`)),s.onload=()=>{r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),t.removeAttribute("href"),t.setAttributeNS(y,"href",r.toDataURL("image/png")),n()},s.src=e}))}function S(t,e){let n;const o=t.viewBox&&t.viewBox.baseVal&&t.viewBox.baseVal[e]||(n=t.getAttribute(e))&&n.match(/%$/)&&parseInt(n)||t.getBoundingClientRect()[e]||parseInt(t.style[e])||parseInt(window.getComputedStyle(t).getPropertyValue(e));return null==o||isNaN(Number(o))?0:o}function x(t,e,n,o){t.getAttribute(n)||t.setAttributeNS(e,n,o)}async function C(t,e){if(!(t instanceof HTMLElement||t instanceof SVGElement))throw new Error(`an HTMLElement or SVGElement is required; got ${t}`);const{left:n=0,top:o=0,width:r,height:s,scale:i=1,backgroundColor:c,responsive:l=!1,excludeCss:u=!1}=e||{},f=t.cloneNode(!0);await function(t){const e=[];for(const o of t.querySelectorAll("image")){let t=o.getAttributeNS(y,"href")||o.getAttribute("href")||"";t&&(n=t,Boolean(n&&0===n.lastIndexOf("http",0)&&-1===n.lastIndexOf(window.location.host))&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),e.push(b(o,t)))}var n;return Promise.all(e)}(f),f.style.backgroundColor=c||t.style.backgroundColor;const{svg:d,width:h,height:C}=function(t,e,n,o){if(t instanceof SVGSVGElement)return{width:e||S(t,"width"),height:n||S(t,"height"),svg:o};if(t instanceof SVGGraphicsElement){o.hasAttribute("transform")&&o.setAttribute("transform",o.getAttribute("transform").replace(/translate\(.*?\)/,""));const e=document.createElementNS(p,"svg");e.appendChild(o);const n=t.getBBox();return{width:n.x+n.width,height:n.y+n.height,svg:e}}throw new TypeError("Attempted to render non-SVG element")}(t,r,s,f);d.setAttribute("version","1.1"),d.setAttribute("viewBox",[n,o,h,C].join(" ")),x(d,m,"xmlns",p),x(d,m,"xmlns:xlink",y),l?(d.removeAttribute("width"),d.removeAttribute("height"),d.setAttribute("preserveAspectRatio","xMinYMin meet")):(d.setAttribute("width",(h*i).toString()),d.setAttribute("height",(C*i).toString()));for(const t of d.querySelectorAll("foreignObject > *"))x(t,m,"xmlns","svg"===t.tagName?p:g);if(!u){const t=a(`<![CDATA[\n${await w(f,e)}\n]]>`),n=document.createElement("defs");n.appendChild(t),d.insertBefore(n,d.firstChild)}return d}const v='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>';function A(t){return`data:image/svg+xml;base64,${window.btoa((e=v+t.outerHTML,decodeURIComponent(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((t,e)=>{const n=String.fromCharCode(Number("0x"+e));return"%"===n?"%25":n})))))}`;var e}async function R(t,e){return A(await C(t,e))}async function $(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o)},o.onerror=()=>{n(`Error loading data uri as image:\n${window.atob(t.slice(26))}Open the following link to see browser's diagnosis\n${t}`)},o.src=t}))}function E(t,e){const n=document.createElement("canvas"),o=n.getContext("2d",e&&e.canvasSettings||void 0),r=window.devicePixelRatio||1;return n.width=t.width*r,n.height=t.height*r,n.style.width=`${n.width}px`,n.style.height=`${n.height}px`,o.setTransform(r,0,0,r,0,0),o.drawImage(t,0,0),n}const T=Object.freeze({type:"image/png",quality:.8});function I(t){return Object.assign({},T,t)}function U(t,e){const{type:n,quality:o}=I(e);return t.toDataURL(n,o)}async function N(t,e){const{type:n,quality:o}=I(e);return new Promise(((e,r)=>{t.toBlob((t=>t?e(t):r("Error converting SVG data URI to blob")),n,o)}))}async function O(t,e){const n=await R(t,e);return E(await $(n))}async function k(t,e){return U(await O(t,e),e)}async function B(t,e){return N(await O(t,e),e)}async function L(t,e){const n=document.createElement("a");n.download=t,n.style.display="none",document.body.appendChild(n);const o=e instanceof Blob?e:await(await fetch(e)).blob(),r=URL.createObjectURL(o);n.href=r,n.onclick=()=>requestAnimationFrame((()=>{document.body.removeChild(n),URL.revokeObjectURL(r)})),n.click()}async function j(t,e,n){return L(e,await R(t,n))}async function F(t,e,n){return L(e,await B(t,n))}export{N as canvasToRasterBlob,U as canvasToRasterDataUri,$ as dataUriToImage,L as download,j as downloadSvg,F as downloadSvgAsRaster,E as imageToCanvas,A as inlinedSvgToDataUri,C as svgToInlinedSvg,R as svgToInlinedSvgDataUri,B as svgToRasterBlob,k as svgToRasterDataUri};
