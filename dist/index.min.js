!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).exportSvg={})}(this,(function(t){"use strict";const e="http://www.w3.org/2000/xmlns/",n="http://www.w3.org/1999/xhtml",o="http://www.w3.org/2000/svg",r="http://www.w3.org/1999/xlink";class s{constructor(t,e){this.accessor=t,this.reader=e,this.content={}}async get(t){const e=this.accessor(t);if(this.content[e])return this.content[e];try{const n=await fetch(e);if(!n.ok)throw new Error("Fetch error: "+n.status);const o=await this.reader(t,n);return this.content[e]=o,o}catch(t){return console.warn(`Failed to load data from: ${e}`,t),null}}}const a=/url\(["']?(.+?)["']?\)/,i=Object.freeze({woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"});function c(t){for(const e of Object.entries(i))if(t.endsWith(`.${e[0]}`))return e[1];return console.error(`Unknown font format for ${t}. Fonts may not be working correctly.`),"application/octet-stream"}const l=new s((t=>t.url),(async function(t,e){const n=function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(await e.arrayBuffer());return t.text.replace(a,`url("data:${t.format};base64,${n}")`)+"\n"}));const u=new s((t=>t),(async function(t,e){const n=await e.text(),o=document.body.appendChild(d(n)),r={href:t,rules:o.sheet&&o.sheet.cssRules?Array.from(o.sheet.cssRules):[]};return o.remove(),r}));async function f(t){try{if(t.cssRules)return{rules:t.cssRules,href:t.href}}catch(e){if(t.href)return u.get(t.href);console.warn(`Stylesheet could not be loaded: ${t.href}`,e)}return null}function d(t){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,e}function h(t,e,n,o){return!t.style||!!function(t,e){if(e)try{return t.querySelector(e)||t.parentNode&&t.parentNode.querySelector(e)}catch(t){console.warn(`Invalid CSS selector "${e}"`,t)}return null}(e,t.selectorText)&&(o.push(n(t.selectorText,t.style.cssText)),!0)}function m(t,e,n,o){if(o.detectFonts){const o=function(t,e){const n=t.match(a),o=n&&n[1]||"";if(!o||o.match(/^data:/)||"about:blank"===o)return null;let r;return r=o.startsWith("../")?`${e}/../${o}`:o.startsWith("./")?`${e}/${o}`:o,r=r.toLowerCase(),{text:t,format:c(r),url:r}}(t.cssText,e);o&&n.push(o)}return!0}async function w(t,e,n,o,r){return matchMedia(t.conditionText).matches&&await y(t.cssRules,n,e,o,r),!0}async function g(t,e,n,o,r){return"supports"in CSS&&CSS.supports(t.conditionText)&&await y(t.cssRules,n,e,o,r),!0}async function p(t,e,n,o){if(!t.media.length||matchMedia(t.media.mediaText).matches)try{const r=await u.get(t.href);r&&await y(r.rules,t.href,e,n,o)}catch(e){console.warn(`Could not load @imported stylesheet from "${t.href}"`,e)}return!0}async function y(t,e,n,o,r){for(const s of t){let t=!1;s instanceof CSSStyleRule?t=h(s,n,r.generateCss,o.css):s instanceof CSSMediaRule?t=await w(s,n,e,o,r):s instanceof CSSFontFaceRule?t=m(s,e,o.fonts,r):s instanceof CSSSupportsRule?t=await g(s,n,e,o,r):s instanceof CSSImportRule&&(t=await p(s,n,o,r)),t||r.excludeUnusedCss||o.css.push(s.cssText)}}const b=(t,e)=>`${t}{${e}}\n`;function x(t){if("function"==typeof t)return t;if(t){const e=t=>t,{selectorRemap:n=e,modifyStyle:o=e}=t;return(t,e)=>b(n(t),o(e))}return b}async function v(t,e){const{modifyCss:n,fonts:o,excludeUnusedCss:r=!1}=e||{},s={css:[],fonts:o||[]},a={generateCss:x(n),excludeUnusedCss:r,detectFonts:!o},i=await async function(){return Promise.all(Array.from(document.styleSheets).filter((t=>!t.media.length||matchMedia(t.media.mediaText).matches)).map(f)).then((t=>t.filter((t=>t))))}();for(const{rules:e,href:n}of i)await y(e,n,t,s,a);const c=await async function(t){return(await Promise.all(t.map((t=>l.get(t))))).join("")}(s.fonts);return s.css.join("\n")+c}function S(t,e){return new Promise(((n,o)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{const e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0),t.removeAttribute("href"),t.setAttributeNS(r,"href",e.toDataURL("image/png")),n()},s.onerror=()=>{o(new Error(`Could not load ${e}`))},s.src=e}))}function C(t,e){let n;const o=t.viewBox&&t.viewBox.baseVal&&t.viewBox.baseVal[e]||(n=t.getAttribute(e))&&n.match(/%$/)&&parseInt(n)||t.getBoundingClientRect()[e]||parseInt(t.style[e])||parseInt(getComputedStyle(t).getPropertyValue(e));return null==o||isNaN(Number(o))?0:o}function T(t,e,n,o){t.getAttribute(n)||t.setAttributeNS(e,n,o)}async function A(t,s){if(!(t instanceof HTMLElement||t instanceof SVGElement))throw new TypeError(`an HTMLElement or SVGElement is required; got ${t}`);const{left:a=0,top:i=0,width:c,height:l,scale:u=1,backgroundColor:f,responsive:h=!1,excludeCss:m=!1}=s||{},w=t.cloneNode(!0);await function(t){const e=[];for(const o of t.querySelectorAll("image")){let t=o.getAttribute("href")||o.getAttributeNS(r,"href")||"";t&&(n=t,Boolean(n&&0===n.lastIndexOf("http",0)&&-1===n.lastIndexOf(location.host))&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),e.push(S(o,t)))}var n;return Promise.all(e)}(w),w.style.backgroundColor=f||t.style.backgroundColor;const{svg:g,width:p,height:y}=function(t,e,n,r){if(t instanceof SVGSVGElement)return{width:e||C(t,"width"),height:n||C(t,"height"),svg:r};if(t instanceof SVGGraphicsElement){r.hasAttribute("transform")&&r.setAttribute("transform",r.getAttribute("transform").replace(/translate\(.*?\)/,""));const e=document.createElementNS(o,"svg");e.appendChild(r);const n=t.getBBox();return{width:n.x+n.width,height:n.y+n.height,svg:e}}throw new TypeError("Attempted to render non-SVG element")}(t,c,l,w);g.setAttribute("version","1.1"),g.setAttribute("viewBox",[a,i,p,y].join(" ")),T(g,e,"xmlns",o),T(g,e,"xmlns:xlink",r),h?(g.removeAttribute("width"),g.removeAttribute("height"),g.setAttribute("preserveAspectRatio","xMinYMin meet")):(g.setAttribute("width",(p*u).toString()),g.setAttribute("height",(y*u).toString()));for(const t of g.querySelectorAll("svg"))T(t,e,"xmlns",o),T(t,e,"xmlns:xlink",r);for(const t of g.querySelectorAll("foreignObject > *:not(svg)"))T(t,e,"xmlns",n);if(!m){const e=d(`<![CDATA[\n${await v(t,s)}\n]]>`),n=document.createElement("defs");n.appendChild(e),g.insertBefore(n,g.firstChild)}return g}const R='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>';function $(t){return`data:image/svg+xml;base64,${btoa((e=R+t.outerHTML,decodeURIComponent(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((t,e)=>{const n=String.fromCharCode(Number("0x"+e));return"%"===n?"%25":n})))))}`;var e}async function E(t,e){return $(await A(t,e))}async function U(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o)},o.onerror=()=>{n(`Error loading data uri as image:\n${atob(t.slice(26))}\nOpen the following link to see browser's diagnosis\n${t}`)},o.src=t}))}function I(t,e){const n=document.createElement("canvas"),o=n.getContext("2d",e&&e.canvasSettings||void 0),r=devicePixelRatio||1;return n.width=t.width*r,n.height=t.height*r,n.style.width=`${n.width}px`,n.style.height=`${n.height}px`,o.setTransform(r,0,0,r,0,0),o.drawImage(t,0,0),n}const N=Object.freeze({type:"image/png",quality:.8});function k(t){return Object.assign({},N,t)}function B(t,e){const{type:n,quality:o}=k(e);return t.toDataURL(n,o)}async function O(t,e){const{type:n,quality:o}=k(e);return new Promise(((e,r)=>{t.toBlob((t=>t?e(t):r("Error converting SVG data URI to blob")),n,o)}))}async function D(t,e){const n=await E(t,e);return I(await U(n))}async function L(t,e){return O(await D(t,e),e)}async function j(t,e){const n=document.createElement("a");n.download=t,n.style.display="none",document.body.appendChild(n);const o=e instanceof Blob?e:await(await fetch(e)).blob(),r=URL.createObjectURL(o);n.href=r,n.onclick=()=>requestAnimationFrame((()=>{document.body.removeChild(n),URL.revokeObjectURL(r)})),n.click()}t.canvasToRasterBlob=O,t.canvasToRasterDataUri=B,t.dataUriToImage=U,t.download=j,t.downloadSvg=async function(t,e,n){return j(e,await E(t,n))},t.downloadSvgAsRaster=async function(t,e,n){return j(e,await L(t,n))},t.imageToCanvas=I,t.inlinedSvgToDataUri=$,t.svgNs=o,t.svgToInlinedSvg=A,t.svgToInlinedSvgDataUri=E,t.svgToRasterBlob=L,t.svgToRasterDataUri=async function(t,e){return B(await D(t,e),e)},t.xhtmlNs=n,t.xlinkNs=r,t.xmlNs=e}));
